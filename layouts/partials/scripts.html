
{{ $jsCarousel := resources.Get "js/carousel.js" }}
{{ $jsCarousel := $jsCarousel | minify }}
{{ if .Page.Params.carouselscript }}
<script type="text/javascript" src="{{$jsCarousel.RelPermalink}}" crossorigin="anonymous"></script>
{{ end }}

<!-- JS for email newsletter sign up form -->
{{ if .Page.Params.emailform }}
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
<script>
  hbspt.forms.create({
    region: "na1",
    portalId: "21390457",
    formId: "30bcfea3-2a4f-4e20-8a38-eb056af9e2e1",
    target: "#emailform",
    css: ""
  });
</script>
{{ end }}

<!-- INKEEP start -->
<script
type="module"
src="https://unpkg.com/@inkeep/uikit-js@0.3.20/dist/embed.js"
defer
></script>
<script type="module" defer>

// Inkeep START

const INKEEP_API_KEY = "b17e5b4e252d7ce29b48a48a3dcba6fcfdc045680e8ea576";
const INKEEP_INTEGRATION_ID = "cm3ogfzp4003f29brrf16r6gm";
const INKEEP_ORGANIZATION_ID = "org_yjUXfeVC1tTVMIoY";

// Get the button element
const inkeepButtonTop = document.getElementById("chatButtonTop");
const inkeepButtonBottom = document.getElementById("chatButton");

// Create a new div element to hold the Inkeep modal and set its id and position
const inkeepDiv = document.createElement("div");
inkeepDiv.id = "inkeepModal";
inkeepDiv.style.position = "absolute";

document.body.appendChild(inkeepDiv);

const handleClose = () => {
inkeepWidgetAI.render({
    ...config,
    isOpen: false,
});
};

const handleOpen = () => {
inkeepWidgetAI.render({
    ...config,
    isOpen: true,
});
}

const config = {
  componentType: "CustomTrigger", // required
  targetElement: inkeepDiv, // required
  properties: {
      isOpen: false, // required
      onClose: handleClose, // required
      onOpen: undefined,
      baseSettings: {
        apiKey: INKEEP_API_KEY,
        integrationId: INKEEP_INTEGRATION_ID,
        organizationId: INKEEP_ORGANIZATION_ID,
        primaryBrandColor: "#000000",
        organizationDisplayName: "Viam AI Bot",
        //... optional base settings
        },
      modalSettings: {
      // optional InkeepModalSettings
        defaultView: "AI_CHAT",
        isShortcutKeyEnabled: false,
        isModeSwitchingEnabled: false
      },
      aiChatSettings: {
          chatSubjectName: "Viam",
          botAvatarSrcUrl: "https://cdn.prod.website-files.com/62fba5686b6d47fe2a1ed2a6/62fba8f4a8ca05f38a2b497f_viam-logo-webclip.png",
          botAvatarDarkSrcUrl: "https://storage.googleapis.com/organization-image-assets/viam-botAvatarDarkSrcUrl-1721328398594.svg",
          getHelpCallToActions: [
              {
                  name: "Email",
                  url: "mailto:support@viam.com",
                  icon: {
                      builtIn: "IoMail"
                  }
              },
              {
                  name: "Discord",
                  url: "https://discord.gg/viam",
                  icon: {
                      builtIn: "FaDiscord"
                  }
              }
          ],
          quickQuestions: [
              "How to install Viam on microcontrollers?",
              "How to deploy a person detection model?",
              "How can I ingest data from machines?",
              "How to query sensor data with third-party tools?",
          ],
      },
  },
};

// Start search elments

// Embed the widget using the `Inkeep.embed()` function.
const inkeepWidgetAI = Inkeep().embed(config);

// Add event listener to open the Inkeep modal when the button is clicked
inkeepButtonTop.addEventListener("click", handleOpen);
inkeepButtonBottom.addEventListener("click", handleOpen);

// Create an HTML element that the Inkeep widget will be inserted into.
const nav = document.querySelector("#navsearch");
const sidebar = document.getElementById("mobile-search");

const inkeepNavDiv = document.createElement("div");
inkeepNavDiv.id = "navSearchBar";
nav.appendChild(inkeepNavDiv);

const inkeepSidebarDiv = document.createElement("div");
inkeepSidebarDiv.id = "sideSearchBar";
sidebar && sidebar.prepend(inkeepSidebarDiv);

// Function for initializating the widget.
const addInkeepWidget = ({
targetElement,
stylesheetUrls,
isShortcutKeyEnabled,
}) => {
// Embed the widget using the `Inkeep.embed()` function.
const inkeepWidgetSearch = Inkeep().embed({
    componentType: "SearchBar",
    targetElement,
    properties: {
      baseSettings: {
          apiKey: INKEEP_API_KEY,
          integrationId: INKEEP_INTEGRATION_ID,
          organizationId: INKEEP_ORGANIZATION_ID,
          primaryBrandColor: "#000000", // your brand color, widget color scheme is derived from this
          organizationDisplayName: "Viam AI Bot",
          // ...optional settings
          theme: {
          stylesheetUrls,
          // ...optional settings
          },
      },
      modalSettings: {
          // optional settings
          isShortcutKeyEnabled,
          isModeSwitchingEnabled: false
      },
      searchSettings: {
        shouldShowAskAICard: false
          // optional settings
      },
      tabSettings: {
        isAllTabEnabled: true,
        rootBreadcrumbsToUseAsTabs: ["Docs", "Blog", "GitHub", "Viam.com"]
      },
    },
});
};

sidebar &&
addInkeepWidget({
  targetElement: document.getElementById("sideSearchBar"),
  stylesheetUrls: ['https://docs.viam.com/css/inkeep.css'],
  isShortcutKeyEnabled: false,
});

addInkeepWidget({
  targetElement: document.getElementById("navSearchBar"),
  stylesheetUrls: ['https://docs.viam.com/css/inkeep.css'],
  isShortcutKeyEnabled: true,
});


</script>

<!-- <script type="text/javascript" src='{{ "js/embed.js" | relURL }}' crossorigin="anonymous" defer></script> -->
<!-- INKEEP end -->

<!-- START script for lazy loading -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>
{{ $jsLozad := resources.Get "js/lozad.js" }}
{{ $jsLozad := $jsLozad | minify }}
<script src="{{ $jsLozad.RelPermalink }}" crossorigin="anonymous"></script>
<!-- END script for lazy loading -->

<!-- JS for listing models from modules -->
{{ if .Page.Params.modulescript }}

<script src="https://cdn.jsdelivr.net/npm/typesense-instantsearch-adapter@2/dist/typesense-instantsearch-adapter.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.46.0"></script>

{{ $jsModels := resources.Get "js/models.js" }}
{{ if (eq (substr .Site.BaseURL -1) "/" ) }}
{{- $opts := dict
"params" (dict "baseURL" (substr .Site.BaseURL 0 -1 ))
-}}
{{- $jsModels = $jsModels | js.Build $opts -}}
{{ $jsModels := $jsModels | minify }}
<script type="text/javascript" src="{{ $jsModels.RelPermalink }}" crossorigin="anonymous"></script>
{{ else }}
{{- $opts := dict
"params" (dict "baseURL" .Site.BaseURL)
-}}
{{- $jsModels = $jsModels | js.Build $opts -}}
{{ $jsModels := $jsModels | minify }}
<script type="text/javascript" src="{{ $jsModels.RelPermalink }}" crossorigin="anonymous"></script>
{{ end }}
{{ end }}

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>

{{ if .Site.Params.mermaid.enable }}
<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js" integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin="anonymous"></script>
{{ end }}

{{ if .Site.Params.markmap.enable }}
<style>
.markmap > svg {
    width: 100%;
    height: 300px;
}
</style>
<script>
window.markmap = {
    autoLoader: { manual: true },
};
</script>
<script src="https://cdn.jsdelivr.net/npm/markmap-autoloader"></script>
{{ end }}

<script src='{{ "js/tabpane-persist.js" | relURL }}'></script>

<!-- load the deflate.js for plantuml support -->
{{ if .Site.Params.plantuml.enable }}
<script src='{{ "js/deflate.js" | relURL }}'></script>
{{ end }}

<!-- load stylesheet and scripts for KaTeX support -->
{{ if .Site.Params.katex.enable }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"
    integrity="sha512-vJqxkZ+Sugf/6WRlpcxN01qVfX/29hF6qc33eHF1va3NgoV+U+wCi+uTAsQ10sDoGyBxHLdaHvGwDlV3yVYboA==" crossorigin="anonymous">
<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"
    integrity="sha512-5ufNcHqOYgilGEHPfuRIQ5B/vDS1M8+UC+DESZ5CwVgGTg+b2Ol/15rYL/GiCWJ/Sx8oVo0FPFok1dPk8U9INQ=="
    crossorigin="anonymous"></script>
<!-- check whether support of mhchem is enabled in config.toml -->
{{ if .Site.Params.katex.mhchem.enable }}
<!-- To add support for displaying chemical equations and physical units, load the mhchem extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/mhchem.min.js"
    integrity="sha512-HWb6LyQhO6UkmYLjdSblpgiOvvbdkoMRjln0POPhOVbZu3l4QdqwZnMJ/cuwKScU5pWARejB495TAAAz0WNsXQ=="
    crossorigin="anonymous"></script>
{{ end }}
<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src='https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js'
    integrity='sha512-ZA/RPrAo88DlwRnnoNVqKINnQNcWERzRK03PDaA4GIJiVZvGFIWQbdWCsUebMZfkWohnfngsDjXzU6PokO4jGw==' crossorigin='anonymous'
    {{ printf "onload='renderMathInElement(%s, %s);'" (( .Site.Params.katex.html_dom_element | default "document.body" ) | safeJS ) ( printf "%s" ( $.Site.Params.katex.options | jsonify )) | safeHTMLAttr }}></script>
{{ end }}


{{ $jsIndex := resources.Get "js/index.js" }}
{{ $jsPrismViam := resources.Get "js/prism.js" }}
{{ $jsToc := resources.Get "js/toc.js" }}
{{ $jsBase := resources.Get "js/base.js" }}
{{ $jsZoom := resources.Get "js/zoom.js" }}
{{ $jsAnchor := resources.Get "js/anchor.js" }}
{{ $jsSearch := resources.Get "js/search.js" | resources.ExecuteAsTemplate "js/search.js" .Site.Home }}
{{ $jsMermaid := resources.Get "js/mermaid.js" | resources.ExecuteAsTemplate "js/mermaid.js" . }}
{{ $jsMarkmap := resources.Get "js/markmap.js" | resources.ExecuteAsTemplate "js/markmap.js" . }}
{{ $jsPlantuml := resources.Get "js/plantuml.js" | resources.ExecuteAsTemplate "js/plantuml.js" . }}
{{ $jsDrawio := resources.Get "js/drawio.js" | resources.ExecuteAsTemplate "js/plantuml.js" .}}

{{ $jsSentry := resources.Get "js/sentry.js" }}

{{ if .Site.Params.offlineSearch }}
{{ $jsSearch = resources.Get "js/offline-search.js" }}
{{ end }}
{{ if not hugo.IsProduction }}
{{ $js := (slice $jsIndex $jsToc $jsBase $jsAnchor $jsSearch $jsMermaid $jsPlantuml $jsMarkmap $jsDrawio $jsPrismViam $jsZoom) | resources.Concat "js/main.js" }}
<script src="{{ $js.RelPermalink }}"></script>
{{ else }}
{{ $js := (slice $jsIndex $jsToc $jsBase $jsAnchor $jsSearch $jsMermaid $jsPlantuml $jsMarkmap $jsDrawio $jsPrismViam $jsZoom) | resources.Concat "js/main.js" }}
{{ $js := $js | minify | fingerprint }}
{{ $jsSentry := $jsSentry | minify }}
<script async src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" crossorigin="anonymous"></script>
<script async src="{{ $jsSentry.RelPermalink }}" crossorigin="anonymous"></script>
{{ end }}

{{ partial "hooks/body-end.html" . }}